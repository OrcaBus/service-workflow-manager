---
"$schema": http://json-schema.org/draft-04/schema#
"$id": https://raw.githubusercontent.com/umccr/orcabus/main/docs/schemas/events/workflowmanager/AnalysisRunStateChange.schema.json
description: EventBridge custom event schema for AnalysisRunInitiated events
title: AWSEvent
type: object
required:
  - source      # defines the event emitter: a process preparing and requesting an analysis to be run
  - detail-type # defines the event type: AnalysisRunInitiated
  - detail      # actual event data
properties:  # these properties are mainly controlled and managed by AWS EventBridge
  id:
    type: string
  region:
    type: string
  resources:
    type: array
    items:
      type: string
  source:
    type: string
  time:
    type: string
    format: date-time
  version:
    type: string
  account:
    type: string
  detail-type:
    type: string
  detail:
    "$ref": "#/definitions/AnalysisRunInitiated"
definitions:
  AnalysisRunInitiated:  # the actual data event of the application
    type: object
    required:  # this is a initiation event, we expect pretty much all data
      - version
      - id
      - timestamp
      - analysisRunName
      - analysis
      - libraries
    properties:
      id:
        # unique id for the data event, e.g. a hashed event data, useful for deduplication, NOTE: independent of the AWS event id
        type: string
      version:
        # the version associated with the event schema version following semver
        type: string
      timestamp:
        # time of the state change (not necessarily the event time, which is already covered in the AWS wrapper)
        type: string
        format: date-time
      analysisRunName:
        # name of the AnalysisRun this event relates to
        type: string
      analysis:
        "$ref": "#/definitions/Analysis"
      libraries:
        # libraries associated with this AnalysisRun
        type: array
        items:
          "$ref": "#/definitions/Library"
      computeEnv:
        # the storage configuration to apply to Workflows under this AnalysisRun
        type: string
      storageEnv:
        # the compute configuration to apply to Workflows under this AnalysisRun
        type: string
  Library:
    type: object
    required:
      - libraryId
      - orcabusId
    properties:
      libraryId:
        # the lab assigned library id, e.g. L000123
        type: string
      orcabusId:
        # the OrcaBus internal library id, e.g. lib.001234EXAMPLE56789ABCDEFGH
        type: string
      readsets:
        # the readsets (fastq pairs) of this library that are to be used in the analysis (if already known)
        type: array
        items:
          "$ref": "#/definitions/Readset"
  Readset:
    type: object
    required:
      - orcabusId
    properties:
      orcabusId:
        # the OrcaBus internal id of the fastq readset record, e.g. fqr.001234EXAMPLE56789AABBCCDD
        type: string
        # could be a reference to the FastqListRow entry generated by BCL Convert or a re-creatable id, but perhaps not needed?
      rgid:
        type: string
  Analysis:
    type: object
    required:
      - orcabusId
    properties:
      orcabusId:
        # the OrcaBus internal id of the parent Analysis, e.g. ana.001234EXAMPLE56789ANALYSIS
        type: string
      name:
        # the name of the Analysis (mainly for human readability)
        type: string
      version:
        # the version of the Analysis (mainly for human readability)
        type: string
